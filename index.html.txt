<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test-Landingpage – Automatisierte Vorqualifizierung</title>
  <style>
    :root { --bg:#0b0f17; --card:#111827; --muted:#93a4b7; --text:#e7eef7; --line:#243244; --ok:#22c55e; --warn:#f59e0b; }
    * { box-sizing:border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:linear-gradient(180deg,#070a10, var(--bg)); color:var(--text); }
    a { color:inherit; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px 16px 64px; }
    .top { display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .brand { display:flex; align-items:center; gap:10px; }
    .logo { width:38px; height:38px; border-radius:12px; background:linear-gradient(135deg,#60a5fa,#22c55e); }
    .pill { font-size:12px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; color:var(--muted); }
    .hero { margin-top: 22px; display:grid; grid-template-columns: 1.1fr 0.9fr; gap:18px; }
    @media (max-width: 880px){ .hero { grid-template-columns: 1fr; } }
    .card { background: rgba(17,24,39,0.9); border:1px solid var(--line); border-radius:20px; padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { margin:0 0 10px; font-size: 34px; line-height:1.1; letter-spacing:-.02em; }
    p { margin:0 0 10px; color:var(--muted); }
    .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width: 640px){ .grid2{ grid-template-columns:1fr; } }
    .btn { cursor:pointer; border:1px solid var(--line); background:#0f172a; color:var(--text); padding:12px 14px; border-radius:14px; font-weight:600; }
    .btn.primary { background: linear-gradient(135deg,#2563eb,#22c55e); border-color: transparent; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .stepper { display:flex; gap:8px; align-items:center; }
    .dot { width:10px; height:10px; border-radius:999px; background:#334155; }
    .dot.on { background:#60a5fa; }
    .field { display:flex; flex-direction:column; gap:8px; margin-top:12px; }
    label { font-size: 12px; color: var(--muted); }
    input, select, textarea {
      width:100%; padding:12px 12px; border-radius:14px; border:1px solid var(--line);
      background:#0b1220; color:var(--text); outline:none;
    }
    textarea { min-height: 90px; resize: vertical; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-top:14px; }
    .hint { font-size: 12px; color: var(--muted); }
    .badge { display:inline-flex; align-items:center; gap:8px; font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--line); color:var(--muted); }
    .badge.ok { border-color: rgba(34,197,94,.4); color: #a7f3d0; }
    .badge.warn { border-color: rgba(245,158,11,.4); color: #fde68a; }
    .resultBox { margin-top: 12px; border:1px dashed var(--line); border-radius:18px; padding:14px; background: rgba(2,6,23,.35); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New"; font-size:12px; color:#c7d2fe; white-space:pre-wrap; word-break:break-word; }
    .kpis { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:12px; }
    .kpi { padding:12px; border-radius:16px; border:1px solid var(--line); background: rgba(2,6,23,.25); }
    .kpi .t { font-size:12px; color:var(--muted); }
    .kpi .v { font-size:18px; font-weight:800; margin-top:4px; }
    .footer { margin-top: 14px; font-size:12px; color:var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div style="font-weight:900;">Automation Funnel (Test)</div>
          <div class="hint">Landingpage + Vorqualifizierung + Routing</div>
        </div>
      </div>
      <div class="pill">Handelsvertreter-Setup · keine Maklerlogik · MVP</div>
    </div>

    <div class="hero">
      <div class="card">
        <h1>Mehr passende Anfragen. Weniger Zeitfresser.</h1>
        <p>
          Das System qualifiziert automatisch nach Zielgruppe und Sparquote und leitet in
          <b>automatisierte Abratung</b> oder <b>persönliche Beratung</b>.
        </p>

        <div class="kpis">
          <div class="kpi">
            <div class="t">Routing-Regel</div>
            <div class="v">&lt; 200€ → Automation</div>
          </div>
          <div class="kpi">
            <div class="t">Routing-Regel</div>
            <div class="v">≥ 200€ → Beratung</div>
          </div>
        </div>

        <div class="row" style="margin-top:16px;">
          <button class="btn primary" id="startBtn">Jetzt starten</button>
          <span class="hint">Dauer: ~60 Sekunden</span>
        </div>

        <div class="footer">
          Hinweis: Demo. Für Livebetrieb müsst ihr DSGVO/Einwilligungen & Anbieterbindung sauber integrieren.
        </div>
      </div>

      <div class="card" id="funnelCard" style="display:none;">
        <div class="row" style="margin-top:0;">
          <div class="stepper" id="stepper"></div>
          <span class="badge" id="scoreBadge">Score: –</span>
        </div>

        <div id="stepContent"></div>

        <div class="row">
          <button class="btn" id="backBtn">Zurück</button>
          <button class="btn primary" id="nextBtn">Weiter</button>
        </div>

        <div class="hint" id="stepHint" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  // -----------------------------
  // State
  // -----------------------------
  const state = {
    step: 0,
    data: {
      persona: "",              // Unternehmer | Beamter | Angestellt
      situation: "",            // Kurztext
      incomeRange: "",          // <2500 | 2500-4000 | 4000-7000 | >7000
      monthlySave: null,        // number
      assetsRange: "",          // <10k | 10-50k | 50-200k | >200k
      goal: "",                 // Vermögensaufbau | Altersvorsorge | Steuer | Absicherung
      urgency: "",              // 0-3 Monate | 3-12 Monate | nur Info
      consent: false,
      email: "",
      phone: ""
    },
    score: 0,
    route: null,               // "AUTO" | "HUMAN"
    track: []                  // Steps visited
  };

  // -----------------------------
  // Helpers
  // -----------------------------
  const $ = (id) => document.getElementById(id);

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function calcScore(d){
    let s = 0;

    // Sparquote: Hauptsignal
    const m = Number(d.monthlySave || 0);
    if (m >= 500) s += 60;
    else if (m >= 200) s += 45;
    else if (m >= 100) s += 25;
    else if (m >= 30) s += 10;

    // Einkommen
    const inc = d.incomeRange;
    if (inc === ">7000") s += 20;
    else if (inc === "4000-7000") s += 14;
    else if (inc === "2500-4000") s += 8;
    else if (inc === "<2500") s += 3;

    // Vermögen
    const a = d.assetsRange;
    if (a === ">200k") s += 15;
    else if (a === "50-200k") s += 10;
    else if (a === "10-50k") s += 6;
    else if (a === "<10k") s += 2;

    // Dringlichkeit
    if (d.urgency === "0-3") s += 10;
    else if (d.urgency === "3-12") s += 6;
    else if (d.urgency === "info") s += 2;

    // Persona-Fit (nur als kleine Gewichtung)
    if (d.persona === "Unternehmer") s += 5;
    if (d.persona === "Beamter") s += 5;

    return clamp(s, 0, 100);
  }

  function calcRoute(d){
    const m = Number(d.monthlySave || 0);
    return (m >= 200) ? "HUMAN" : "AUTO";
  }

  function renderStepper(){
    const total = steps.length;
    const el = $("stepper");
    el.innerHTML = "";
    for (let i=0;i<total;i++){
      const dot = document.createElement("div");
      dot.className = "dot" + (i===state.step ? " on" : "");
      el.appendChild(dot);
    }
  }

  function badge(score, route){
    const b = $("scoreBadge");
    b.textContent = `Score: ${score} · Route: ${route === "HUMAN" ? "Beratung" : "Automation"}`;
    b.className = "badge " + (route === "HUMAN" ? "ok" : "warn");
  }

  function setHint(txt){ $("stepHint").textContent = txt || ""; }

  function validateStep(){
    const d = state.data;
    switch(state.step){
      case 0: return !!d.persona;
      case 1: return !!d.incomeRange && d.monthlySave !== null && d.monthlySave !== "" && Number(d.monthlySave) >= 0;
      case 2: return !!d.assetsRange && !!d.goal && !!d.urgency;
      case 3: return d.consent && (d.email.trim().length > 3 || d.phone.trim().length > 5);
      default: return true;
    }
  }

  function updateNextDisabled(){
    $("nextBtn").disabled = !validateStep();
  }

  function setData(patch){
    state.data = { ...state.data, ...patch };
    state.score = calcScore(state.data);
    state.route = calcRoute(state.data);
    badge(state.score, state.route);
    updateNextDisabled();
  }

  // -----------------------------
  // Steps UI
  // -----------------------------
  const steps = [
    // Step 0
    () => {
      setHint("Wähle die Zielgruppe. Das steuert euer Messaging & Routing.");
      return `
        <h3 style="margin:10px 0 6px;">1) Zielgruppe</h3>
        <div class="field">
          <label>Ich bin...</label>
          <select id="persona">
            <option value="">Bitte wählen</option>
            <option value="Unternehmer">Unternehmer / Selbstständig</option>
            <option value="Beamter">Öffentlicher Dienst / Beamter</option>
            <option value="Angestellt">Angestellt (später ausbaubar)</option>
          </select>
        </div>
        <div class="field">
          <label>Kurzbeschreibung (optional)</label>
          <textarea id="situation" placeholder="z.B. GmbH, schwankende Einnahmen, Ziele..."></textarea>
        </div>
      `;
    },

    // Step 1
    () => {
      setHint("Sparquote triggert Automation vs. persönliche Beratung.");
      return `
        <h3 style="margin:10px 0 6px;">2) Sparquote & Einkommen</h3>
        <div class="grid2">
          <div class="field">
            <label>Nettoeinkommen (Range)</label>
            <select id="incomeRange">
              <option value="">Bitte wählen</option>
              <option value="<2500">&lt; 2.500 €</option>
              <option value="2500-4000">2.500–4.000 €</option>
              <option value="4000-7000">4.000–7.000 €</option>
              <option value=">7000">&gt; 7.000 €</option>
            </select>
          </div>
          <div class="field">
            <label>Monatliche Sparquote / Anlagesumme (€)</label>
            <input id="monthlySave" inputmode="numeric" type="number" min="0" step="10" placeholder="z.B. 200" />
            <div class="hint">Regel: &lt;200€ → Automation | ≥200€ → Beratung</div>
          </div>
        </div>
      `;
    },

    // Step 2
    () => {
      setHint("Hier entscheidet ihr Messaging & Angebots-Story im Beratungsgespräch.");
      return `
        <h3 style="margin:10px 0 6px;">3) Ziele & Status</h3>
        <div class="grid2">
          <div class="field">
            <label>Vermögen (grobe Range)</label>
            <select id="assetsRange">
              <option value="">Bitte wählen</option>
              <option value="<10k">&lt; 10.000 €</option>
              <option value="10-50k">10.000–50.000 €</option>
              <option value="50-200k">50.000–200.000 €</option>
              <option value=">200k">&gt; 200.000 €</option>
            </select>
          </div>
          <div class="field">
            <label>Primäres Ziel</label>
            <select id="goal">
              <option value="">Bitte wählen</option>
              <option value="Vermögensaufbau">Vermögensaufbau</option>
              <option value="Altersvorsorge">Altersvorsorge</option>
              <option value="Steuer">Steueroptimierung</option>
              <option value="Absicherung">Risikoabsicherung</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label>Zeithorizont / Dringlichkeit</label>
          <select id="urgency">
            <option value="">Bitte wählen</option>
            <option value="0-3">0–3 Monate</option>
            <option value="3-12">3–12 Monate</option>
            <option value="info">Nur informieren</option>
          </select>
        </div>
      `;
    },

    // Step 3
    () => {
      setHint("Einwilligung + Kontakt = Übergabe an CRM / Terminbuchung / Automation.");
      return `
        <h3 style="margin:10px 0 6px;">4) Kontakt & Einwilligung</h3>
        <div class="grid2">
          <div class="field">
            <label>E-Mail (optional, aber empfohlen)</label>
            <input id="email" type="email" placeholder="name@mail.de" />
          </div>
          <div class="field">
            <label>Telefon (optional)</label>
            <input id="phone" type="tel" placeholder="+49 ..." />
          </div>
        </div>

        <div class="field">
          <label style="display:flex; gap:10px; align-items:flex-start;">
            <input id="consent" type="checkbox" style="width:auto; margin-top:3px;" />
            <span>
              Ich willige ein, dass meine Angaben zur Kontaktaufnahme und Vorqualifizierung verarbeitet werden.
              (Demo-Text – DSGVO/Datenschutz finalisieren!)
            </span>
          </label>
        </div>
      `;
    },

    // Result
    () => {
      const d = state.data;
      const score = state.score;
      const route = state.route;

      const nextAction = (route === "HUMAN")
        ? "Persönliche Beratung: Termin anbieten + Vorbereitungsdaten ins CRM pushen."
        : "Automatisierte Abratung: Video/Guide + Nurturing + Wiedervorlage setzen.";

      const lead = {
        createdAt: new Date().toISOString(),
        persona: d.persona,
        incomeRange: d.incomeRange,
        monthlySave: Number(d.monthlySave || 0),
        assetsRange: d.assetsRange,
        goal: d.goal,
        urgency: d.urgency,
        situation: d.situation || "",
        score,
        route,
        recommendedNextAction: nextAction,
        contact: { email: d.email || "", phone: d.phone || "" }
      };

      return `
        <h3 style="margin:10px 0 6px;">Ergebnis</h3>
        <div class="resultBox">
          <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;">
            <div>
              <div style="font-weight:900; font-size:16px;">
                ${route === "HUMAN" ? "✅ Persönliche Beratung" : "⚠️ Automatisierte Abratung"}
              </div>
              <div class="hint">${nextAction}</div>
            </div>
            <button class="btn" id="copyJson">Lead-JSON kopieren</button>
          </div>

          <div style="margin-top:12px;" class="mono" id="jsonOut"></div>

          <div style="margin-top:12px;">
            ${route === "HUMAN"
              ? `<button class="btn primary" id="bookBtn">Termin-CTA (Demo)</button>
                 <div class="hint" style="margin-top:8px;">Später ersetzt ihr das durch Calendly/YouCanBookMe/SwissLife-Flow.</div>`
              : `<button class="btn primary" id="autoBtn">Abratung starten (Demo)</button>
                 <div class="hint" style="margin-top:8px;">Später ersetzt ihr das durch Video/Guide + E-Mail Sequenz.</div>`
            }
          </div>
        </div>
        <div class="row">
          <button class="btn" id="restartBtn">Neu starten</button>
        </div>
      `;
    }
  ];

  function render(){
    renderStepper();

    const content = steps[state.step]();
    $("stepContent").innerHTML = content;

    // Back button
    $("backBtn").style.display = state.step === 0 ? "none" : "inline-block";
    $("nextBtn").textContent = (state.step === steps.length - 2) ? "Ergebnis" : (state.step === steps.length - 1 ? "Fertig" : "Weiter");
    $("nextBtn").style.display = state.step === steps.length - 1 ? "none" : "inline-block";

    // Bind step fields
    if (state.step === 0){
      const persona = $("persona");
      const situation = $("situation");
      persona.value = state.data.persona;
      situation.value = state.data.situation;

      persona.addEventListener("change", e => setData({ persona: e.target.value }));
      situation.addEventListener("input", e => setData({ situation: e.target.value }));
    }

    if (state.step === 1){
      const incomeRange = $("incomeRange");
      const monthlySave = $("monthlySave");

      incomeRange.value = state.data.incomeRange;
      monthlySave.value = (state.data.monthlySave ?? "");

      incomeRange.addEventListener("change", e => setData({ incomeRange: e.target.value }));
      monthlySave.addEventListener("input", e => setData({ monthlySave: e.target.value }));
    }

    if (state.step === 2){
      const assetsRange = $("assetsRange");
      const goal = $("goal");
      const urgency = $("urgency");

      assetsRange.value = state.data.assetsRange;
      goal.value = state.data.goal;
      urgency.value = state.data.urgency;

      assetsRange.addEventListener("change", e => setData({ assetsRange: e.target.value }));
      goal.addEventListener("change", e => setData({ goal: e.target.value }));
      urgency.addEventListener("change", e => setData({ urgency: e.target.value }));
    }

    if (state.step === 3){
      const email = $("email");
      const phone = $("phone");
      const consent = $("consent");

      email.value = state.data.email;
      phone.value = state.data.phone;
      consent.checked = !!state.data.consent;

      email.addEventListener("input", e => setData({ email: e.target.value }));
      phone.addEventListener("input", e => setData({ phone: e.target.value }));
      consent.addEventListener("change", e => setData({ consent: e.target.checked }));
    }

    if (state.step === 4){
      // Result bindings
      const d = state.data;
      const lead = {
        createdAt: new Date().toISOString(),
        persona: d.persona,
        incomeRange: d.incomeRange,
        monthlySave: Number(d.monthlySave || 0),
        assetsRange: d.assetsRange,
        goal: d.goal,
        urgency: d.urgency,
        situation: d.situation || "",
        score: state.score,
        route: state.route,
        recommendedNextAction: state.route === "HUMAN"
          ? "Persönliche Beratung: Termin anbieten + Vorbereitungsdaten ins CRM pushen."
          : "Automatisierte Abratung: Video/Guide + Nurturing + Wiedervorlage setzen.",
        contact: { email: d.email || "", phone: d.phone || "" }
      };

      $("jsonOut").textContent = JSON.stringify(lead, null, 2);

      $("copyJson").addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(JSON.stringify(lead, null, 2));
          alert("Lead-JSON kopiert.");
        } catch {
          alert("Kopieren nicht möglich (Browser/iOS). Markiere den Text manuell und kopiere ihn.");
        }
      });

      const restart = $("restartBtn");
      restart.addEventListener("click", () => {
        state.step = 0;
        state.data = {
          persona:"", situation:"", incomeRange:"", monthlySave:null,
          assetsRange:"", goal:"", urgency:"", consent:false, email:"", phone:""
        };
        setData(state.data);
        render();
      });

      const bookBtn = $("bookBtn");
      if (bookBtn){
        bookBtn.addEventListener("click", () => alert("Demo: Hier würde der Terminlink öffnen (Calendly/Tool)."));
      }
      const autoBtn = $("autoBtn");
      if (autoBtn){
        autoBtn.addEventListener("click", () => alert("Demo: Hier würde Abratung/Guide/Video starten + E-Mail Sequenz."));
      }
    }

    // Score & route badge
    badge(state.score, state.route);
    updateNextDisabled();
  }

  // -----------------------------
  // Navigation
  // -----------------------------
  $("startBtn").addEventListener("click", () => {
    $("funnelCard").style.display = "block";
    $("startBtn").disabled = true;
    // Initialize
    setData(state.data);
    render();
  });

  $("backBtn").addEventListener("click", () => {
    state.step = Math.max(0, state.step - 1);
    render();
  });

  $("nextBtn").addEventListener("click", () => {
    if (!validateStep()) return;
    state.step = Math.min(steps.length - 1, state.step + 1);
    render();
  });

  // Initial score
  setData(state.data);
})();
</script>
</body>
</html>
